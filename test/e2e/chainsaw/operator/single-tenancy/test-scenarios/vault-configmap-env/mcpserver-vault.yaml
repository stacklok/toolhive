apiVersion: toolhive.stacklok.dev/v1alpha1
kind: MCPServer
metadata:
  name: vault-test
  namespace: toolhive-system
spec:
  image: ghcr.io/stackloklabs/yardstick/yardstick-server:0.0.2
  transport: stdio
  port: 8080
  permissionProfile:
    type: builtin
    name: network
  resources:
    limits:
      cpu: "100m"
      memory: "128Mi"
    requests:
      cpu: "50m"
      memory: "64Mi"
  resourceOverrides:
    proxyDeployment:
      podTemplateMetadataOverrides:
        annotations:
          # Enable Vault Agent injection
          vault.hashicorp.com/agent-inject: "true"
          vault.hashicorp.com/role: "myapp"
          # Inject test configuration secret
          vault.hashicorp.com/agent-inject-secret-config: "secret/myapp/config"
          vault.hashicorp.com/agent-inject-template-config: |
            {{- with secret "secret/myapp/config" -}}
            DATABASE_URL={{ .Data.data.database_url }}
            API_KEY={{ .Data.data.api_key }}
            {{- end -}}