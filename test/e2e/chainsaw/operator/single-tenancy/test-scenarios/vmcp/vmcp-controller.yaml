apiVersion: toolhive.stacklok.dev/v1alpha1
kind: VirtualMCPServer
metadata:
  name: test-vmcp-controller
  namespace: toolhive-system
spec:
  groupRef:
    name: test-group-controller
  incomingAuth:
    # Using Google's public OIDC issuer for testing (discovery will work)
    oidcConfig:
      type: inline
      inline:
        issuer: https://accounts.google.com
        clientId: test-client-id
        clientSecret: test-client-secret
        audience: virtual-mcp-controller
    authzConfig:
      type: inline
      inline:
        policies:
          - 'permit(principal, action, resource);'
  outgoingAuth:
    source: discovered
  aggregation:
    conflictResolution: prefix
    conflictResolutionConfig:
      prefixFormat: "{workload}_"
  operational:
    failureHandling:
      healthCheckInterval: 30s
