apiVersion: chainsaw.kyverno.io/v1alpha1
kind: Test
metadata:
  name: valid-groupref-test
spec:
  description: Test MCPServer with valid GroupRef
  timeouts:
    apply: 30s
    assert: 30s
  steps:
    - name: verify-operator
      description: Ensure operator is ready before testing
      try:
      - assert:
          file: ../../../setup/assert-operator-ready.yaml
    - name: Create MCPGroup
      try:
      - apply:
          file: mcpgroup.yaml
      - assert:
          file: assert-mcpgroup-ready.yaml
    - name: Create MCPServer with GroupRef
      try:
      - apply:
          file: mcpserver.yaml
      - assert:
          file: assert-mcpserver-groupref-validated.yaml
    - name: Cleanup
      try:
      - delete:
          ref:
            apiVersion: toolhive.stacklok.dev/v1alpha1
            kind: MCPServer
            name: test-server
      - delete:
          ref:
            apiVersion: toolhive.stacklok.dev/v1alpha1
            kind: MCPGroup
            name: test-group
