{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/stacklok/toolhive/main/pkg/registry/data/publisher-provided.schema.json",
  "title": "ToolHive Publisher-Provided Extensions Schema",
  "description": "Schema for ToolHive-specific metadata placed under _meta['io.modelcontextprotocol.registry/publisher-provided'] in MCP server definitions. This schema defines the structure of publisher extensions that ToolHive adds to servers in the upstream MCP registry format.",
  "type": "object",
  "properties": {
    "io.github.stacklok": {
      "type": "object",
      "description": "ToolHive publisher namespace containing server-specific extensions keyed by identifier (OCI image reference for container servers, URL for remote servers)",
      "additionalProperties": {
        "$ref": "#/definitions/server_extensions"
      }
    }
  },
  "additionalProperties": {
    "type": "object",
    "description": "Other publisher namespaces may contain arbitrary extensions"
  },
  "definitions": {
    "server_extensions": {
      "type": "object",
      "description": "Extensions for MCP servers. Container servers (keyed by OCI image reference) may use permissions, args, provenance, docker_tags, and proxy_port. Remote servers (keyed by URL) may use oauth_config and env_vars. All servers share status, tier, tools, tags, metadata, and custom_metadata.",
      "required": ["status"],
      "properties": {
        "status": {
          "type": "string",
          "description": "Current status of the server",
          "enum": ["active", "deprecated", "Active", "Deprecated"],
          "default": "active"
        },
        "tier": {
          "type": "string",
          "description": "Tier classification of the server",
          "enum": ["Official", "Community"]
        },
        "tools": {
          "type": "array",
          "description": "List of tool names provided by this MCP server",
          "items": {
            "type": "string",
            "pattern": "^[\\w-]+$"
          },
          "uniqueItems": true
        },
        "tags": {
          "type": "array",
          "description": "Categorization tags for search and filtering",
          "items": {
            "type": "string",
            "pattern": "^[a-z0-9][a-z0-9_-]*[a-z0-9]$"
          },
          "uniqueItems": true
        },
        "metadata": {
          "$ref": "#/definitions/metadata"
        },
        "permissions": {
          "description": "Security permissions for container-based servers",
          "$ref": "#/definitions/permissions"
        },
        "args": {
          "type": "array",
          "description": "Default command-line arguments for container-based servers",
          "items": {
            "type": "string"
          }
        },
        "provenance": {
          "description": "Supply chain provenance for container-based servers",
          "$ref": "#/definitions/provenance"
        },
        "docker_tags": {
          "type": "array",
          "description": "Available Docker tags for container-based servers",
          "items": {
            "type": "string"
          },
          "uniqueItems": true
        },
        "proxy_port": {
          "type": "integer",
          "description": "HTTP proxy port for container-based servers",
          "minimum": 1,
          "maximum": 65535
        },
        "oauth_config": {
          "description": "OAuth/OIDC configuration for remote servers",
          "$ref": "#/definitions/oauth_config"
        },
        "env_vars": {
          "type": "array",
          "description": "Environment variables for remote server client configuration",
          "items": {
            "$ref": "#/definitions/environment_variable"
          }
        },
        "custom_metadata": {
          "type": "object",
          "description": "Custom user-defined metadata",
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    },
    "metadata": {
      "type": "object",
      "description": "Popularity and activity metrics for the MCP server",
      "properties": {
        "stars": {
          "type": "number",
          "description": "Number of repository stars",
          "minimum": 0
        },
        "pulls": {
          "type": "number",
          "description": "Number of container image pulls or usage count",
          "minimum": 0
        },
        "last_updated": {
          "type": "string",
          "description": "Timestamp when the metadata was last updated, in RFC3339 format",
          "format": "date-time"
        }
      },
      "additionalProperties": false
    },
    "permissions": {
      "type": "object",
      "description": "Security permissions applied to the MCP server container",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the permission profile"
        },
        "network": {
          "$ref": "#/definitions/network_permissions"
        },
        "read": {
          "type": "array",
          "description": "File system paths the server needs read access to (will be mounted from the host)",
          "items": {
            "type": "string",
            "pattern": "^(/[^/\\0]+)+/?$"
          },
          "uniqueItems": true
        },
        "write": {
          "type": "array",
          "description": "File system paths the server needs write access to (will be mounted from the host)",
          "items": {
            "type": "string",
            "pattern": "^(/[^/\\0]+)+/?$"
          },
          "uniqueItems": true
        },
        "privileged": {
          "type": "boolean",
          "description": "Whether the container should run in privileged mode",
          "default": false
        }
      },
      "additionalProperties": false
    },
    "network_permissions": {
      "type": "object",
      "description": "Network access permissions for the MCP server",
      "properties": {
        "outbound": {
          "$ref": "#/definitions/outbound_permissions"
        }
      },
      "additionalProperties": false
    },
    "outbound_permissions": {
      "type": "object",
      "description": "Outbound network access permissions",
      "properties": {
        "allow_host": {
          "type": "array",
          "description": "Allowed hostnames or domain patterns for outbound connections",
          "items": {
            "type": "string",
            "anyOf": [
              {
                "format": "hostname"
              },
              {
                "pattern": "^\\.[a-zA-Z0-9]([a-zA-Z0-9.-]*[a-zA-Z0-9])?$"
              }
            ]
          },
          "uniqueItems": true
        },
        "allow_port": {
          "type": "array",
          "description": "Allowed port numbers for outbound connections",
          "items": {
            "type": "integer",
            "minimum": 1,
            "maximum": 65535
          },
          "uniqueItems": true
        },
        "insecure_allow_all": {
          "type": "boolean",
          "description": "Whether to allow all outbound connections (insecure, use with caution)",
          "default": false
        }
      },
      "additionalProperties": false
    },
    "provenance": {
      "type": "object",
      "description": "Software supply chain provenance information for verified servers",
      "properties": {
        "sigstore_url": {
          "type": "string",
          "description": "Sigstore TUF repository host for provenance verification",
          "format": "hostname",
          "examples": ["tuf-repo.github.com", "tuf-repo-cdn.sigstore.dev"]
        },
        "repository_uri": {
          "type": "string",
          "description": "Repository URI used for provenance verification",
          "format": "uri"
        },
        "repository_ref": {
          "type": "string",
          "description": "Repository reference used for provenance verification"
        },
        "signer_identity": {
          "type": "string",
          "description": "Identity of the signer for provenance verification"
        },
        "runner_environment": {
          "type": "string",
          "description": "Build environment where the server was built",
          "examples": ["github-hosted", "gitlab-hosted", "self-hosted"]
        },
        "cert_issuer": {
          "type": "string",
          "description": "Certificate issuer for provenance verification",
          "format": "uri",
          "examples": ["https://token.actions.githubusercontent.com"]
        },
        "attestation": {
          "$ref": "#/definitions/verified_attestation"
        }
      },
      "additionalProperties": false
    },
    "verified_attestation": {
      "type": "object",
      "description": "Verified attestation information",
      "properties": {
        "predicate_type": {
          "type": "string",
          "description": "Type of the attestation predicate",
          "format": "uri",
          "examples": [
            "https://slsa.dev/provenance/v0.2",
            "https://slsa.dev/provenance/v1"
          ]
        },
        "predicate": {
          "description": "Attestation predicate data"
        }
      },
      "additionalProperties": false
    },
    "oauth_config": {
      "type": "object",
      "description": "OAuth/OIDC configuration for remote server authentication",
      "properties": {
        "issuer": {
          "type": "string",
          "description": "OAuth/OIDC issuer URL for OIDC discovery",
          "format": "uri"
        },
        "authorize_url": {
          "type": "string",
          "description": "OAuth authorization endpoint URL (for non-OIDC OAuth)",
          "format": "uri"
        },
        "token_url": {
          "type": "string",
          "description": "OAuth token endpoint URL (for non-OIDC OAuth)",
          "format": "uri"
        },
        "client_id": {
          "type": "string",
          "description": "OAuth client ID for authentication"
        },
        "scopes": {
          "type": "array",
          "description": "OAuth scopes to request",
          "items": {
            "type": "string"
          }
        },
        "use_pkce": {
          "type": "boolean",
          "description": "Whether to use PKCE for the OAuth flow",
          "default": true
        },
        "oauth_params": {
          "type": "object",
          "description": "Additional OAuth parameters to include in the authorization request (server-specific parameters like 'prompt', 'response_mode', etc.)",
          "additionalProperties": {
            "type": "string"
          }
        },
        "callback_port": {
          "type": "integer",
          "description": "Specific port to use for the OAuth callback server",
          "minimum": 1,
          "maximum": 65535
        },
        "resource": {
          "type": "string",
          "description": "OAuth 2.0 resource indicator (RFC 8707)"
        }
      },
      "additionalProperties": false
    },
    "environment_variable": {
      "type": "object",
      "description": "Environment variable definition for MCP server configuration",
      "properties": {
        "name": {
          "type": "string",
          "description": "Environment variable name",
          "pattern": "^[A-Za-z_][A-Za-z0-9_]*$"
        },
        "description": {
          "type": "string",
          "description": "Human-readable explanation of the variable's purpose"
        },
        "required": {
          "type": "boolean",
          "description": "Whether this environment variable is required for the server to function",
          "default": false
        },
        "secret": {
          "type": "boolean",
          "description": "Whether this environment variable contains sensitive information",
          "default": false
        },
        "default": {
          "type": "string",
          "description": "Default value if the environment variable is not provided"
        }
      },
      "additionalProperties": false
    }
  }
}
