# These set of workflows run on every push to the main branch
name: PR Checks

on:
  workflow_dispatch:
  pull_request:
    paths-ignore:
      - deploy/charts/**

permissions:
  contents: read

jobs:
  spellcheck:
    name: Spellcheck
    uses: ./.github/workflows/spellcheck.yml
  license-headers:
    name: License Headers
    uses: ./.github/workflows/license-headers.yml
  linting:
    name: Linting
    uses: ./.github/workflows/lint.yml
  security-scan:
    name: Security Scan
    permissions:
      contents: read
      security-events: write
    uses: ./.github/workflows/security-scan.yml
  tests:
    name: Tests
    uses: ./.github/workflows/test.yml
    secrets: inherit
  docs:
    name: Docs
    uses: ./.github/workflows/verify-docgen.yml
  codegen:
    name: Codegen
    uses: ./.github/workflows/verify-gen.yml
  # Tier 2: Expensive integration tests - only run after all fast checks pass
  helm-charts:
    name: Helm Charts
    uses: ./.github/workflows/helm-charts-test.yml
    secrets: inherit
  e2e-tests:
    name: E2E Tests
    needs: [linting, tests, docs, codegen]
    uses: ./.github/workflows/e2e-tests.yml
  operator-ci:
    name: Operator CI
    needs: [linting, tests, docs, codegen]
    permissions:
      contents: read
    uses: ./.github/workflows/operator-ci.yml
